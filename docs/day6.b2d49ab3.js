function t(t){return t&&t.__esModule?t.default:t}var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},s={},i={},o=e.parcelRequirecc54;null==o&&((o=function(t){if(t in s)return s[t].exports;if(t in i){var e=i[t];delete i[t];var o={id:t,exports:{}};return s[t]=o,e.call(o.exports,o,o.exports),o.exports}var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(t,e){i[t]=e},e.parcelRequirecc54=o);var n=o("6gELa"),a=o("610XN"),r=o("1B70O"),l=(a=o("610XN"),o("20LS2")),d=o("kPMpK"),h=o("l9IGS"),u=o("d5AAH"),c=o("4lFOe"),g=o("2zf1Y"),f=o("7qu5m"),p=o("4DafG"),m=o("iQyfo"),w=class extends p.default{constructor(t){t=t||{};var e=document.createElement("DIV");super({element:e,target:t.target}),this.contentElement=m.default.create("DIV",{click:function(){this.get("hideOnClick")&&this.hide()}.bind(this),parent:e});var s=(t.className||"")+" ol-notification";t.target||(s+=" ol-unselectable ol-control ol-collapsed"),e.setAttribute("class",s),this.set("closeBox",t.closeBox),this.set("hideOnClick",t.hideOnClick)}show(t,e){var s=this,i=this.element;t&&(t instanceof Node?(this.contentElement.innerHTML="",this.contentElement.appendChild(t)):this.contentElement.innerHTML=t,this.get("closeBox")?(this.contentElement.classList.add("ol-close"),m.default.create("SPAN",{className:"closeBox",click:function(){this.hide()}.bind(this),parent:this.contentElement})):this.contentElement.classList.remove("ol-close")),this._listener&&(clearTimeout(this._listener),this._listener=null),i.classList.add("ol-collapsed"),this._listener=setTimeout((function(){i.classList.remove("ol-collapsed"),s._listener=!e||e>=0?setTimeout((function(){i.classList.add("ol-collapsed"),s._listener=null}),e||3e3):null}),100)}hide(){this._listener&&(clearTimeout(this._listener),this._listener=null),this.element.classList.add("ol-collapsed")}toggle(t){this.element.classList.contains("ol-collapsed")?this.show(null,t):this.hide()}},v=o("fnScq"),y=o("hvEnP"),C=o("j2K3b"),b=o("iGyOD"),E=(l=o("20LS2"),o("jZquI")),L=(E=o("jZquI"),o("23ytq")),x=class extends v.default{constructor(t){t=t||{},super(),this.source=t.source,this.nodes=new(0,l.default),this.maxIteration=t.maxIteration||2e4,this.stepIteration=t.stepIteration||2e3,this.astar=!0,this.candidat=[],this.set("epsilon",t.epsilon||1e-6)}weight(){return 1}direction(){return 2}getLength(t){return t.getGeometry&&(t=t.getGeometry()),t.getLength()}getNodeSource(){return this.nodes}getEdges(t){var e=(0,E.buffer)((0,E.boundingExtent)([t]),this.get("epsilon")),s=[];return this.source.forEachFeatureIntersectingExtent(e,(function(t){s.push(t)})),s}getNode(t){var e=(0,E.buffer)((0,E.boundingExtent)([t]),this.get("epsilon")),s=[];return this.nodes.forEachFeatureIntersectingExtent(e,(function(t){s.push(t)})),s[0]}addNode(t,e,s,i,o){if(this.wdist&&e>this.wdist)return!1;var n=this.getNode(t),a=e+this.getLength(new(0,y.default)([this.end,t]))*this.weight();if(this.astar&&this.wdist&&a>this.wdist)return!1;if(n){if(n!==this.arrival&&n.get("wdist")<=e)return n;n.set("dist",s),n.set("wdist",e),n.set("dtotal",a),n.set("from",i),n.set("prev",o),n===this.arrival&&(this.wdist=e),this.candidat.push(n)}else n=new(0,b.default)({geometry:new(0,C.default)(t),from:i,prev:o,dist:s||0,wdist:e,dtotal:a}),e<0?n.set("wdist",!1):this.candidat.push(n),this.nodes.addFeature(n);return n}closestCoordinate(t){var e=this.source.getClosestFeatureToCoordinate(t),s=e.getGeometry().getFirstCoordinate(),i=e.getGeometry().getLastCoordinate();return(0,L.ol_coordinate_dist2d)(t,s)<(0,L.ol_coordinate_dist2d)(t,i)?s:i}path(t,e){if(this.running)return!1;if(t=this.closestCoordinate(t),this.end=this.closestCoordinate(e),t[0]===this.end[0]&&t[1]===this.end[1])return this.dispatchEvent({type:"finish",route:[],wDistance:-1,distance:this.wdist}),!1;var s=this;return this.nodes.clear(),this.candidat=[],this.wdist=0,this.running=!0,this.addNode(t,0),this.arrival=this.addNode(this.end,-1),this.nb=0,this.dispatchEvent({type:"start"}),setTimeout((function(){s._resume()})),[t,this.end]}resume(){this.running||this.candidat.length&&(this.running=!0,this.nb=0,this._resume())}pause(){this.running&&(this.nb=-1)}getBestWay(){for(var t,e,s=-1,i=0;e=this.candidat[i];i++)e.get("wdist")>s&&(t=e,s=e.get("wdist"));return this.getRoute(t)}_resume(){if(this.running){for(;this.candidat.length;){this.candidat.sort((function(t,e){return t.get("dtotal")<e.get("dtotal")?1:t.get("dtotal")===e.get("dtotal")?0:-1}));for(var t,e=this.candidat.pop(),s=e.getGeometry().getCoordinates(),i=this.getEdges(s),o=0;t=i[o];o++){if(e.get("from")!==t){var n=this.getLength(t);n<0&&console.log("distance < 0!");var a=e.get("wdist")+n*this.weight(t);n=e.get("dist")+n;var r=t.getGeometry().getFirstCoordinate(),l=t.getGeometry().getLastCoordinate(),d=this.direction(t);0!==d&&(s[0]===r[0]&&s[1]===r[1]&&-1!==d&&this.addNode(l,a,n,t,e),s[0]===l[0]&&s[0]===l[0]&&1!==d&&this.addNode(r,a,n,t,e))}if(-1===this.nb||this.nb++>this.maxIteration)return this.running=!1,void this.dispatchEvent({type:"pause",overflow:-1!==this.nb});if(!(this.nb%this.stepIteration)){var h=this;return window.setTimeout((function(){h._resume()}),5),void this.dispatchEvent({type:"calculating"})}}}this.nodes.clear(),this.running=!1,this.dispatchEvent({type:"finish",route:this.getRoute(this.arrival),wDistance:this.wdist,distance:this.arrival.get("dist")})}}getRoute(t){for(var e=[];t;)e.unshift(t.get("from")),t=t.get("prev");return e.shift(),e}},N=(r=o("1B70O"),o("5VeMq")),_=class extends N.default{constructor(t){(t=t||{}).popupClass=(t.popupClass||"")+" placemark anim",t.positioning="bottom-center",super(t),this.setPositioning=function(){},t.color&&(this.element.style.color=t.color),t.backgroundColor&&(this.element.style.backgroundColor=t.backgroundColor),t.contentColor&&this.setContentColor(t.contentColor),t.size&&this.setRadius(t.size)}show(t,e){!0===t&&(t=this.getPosition()),this.hide(),super.show(t,e)}setColor(t){this.element.style.color=t}setBackgroundColor(t){this._elt.style.backgroundColor=t}setContentColor(t){var e=this.element.getElementsByClassName("ol-popup-content")[0];e&&(e.style.color=t)}setClassName(t){var e=this.element.className;this.element.className="ol-popup placemark ol-popup-bottom ol-popup-center "+(/visible/.test(e)?"visible ":"")+(/anim/.test(e)?"anim ":"")+t}setRadius(t){this.element.style.fontSize=t+"px"}};const k=new _({popupClass:"flagv",color:"#080"});map.addOverlay(k);const T=new _({popupClass:"flag finish",color:"#000"});map.addOverlay(T);const G=new w;r.default.addControl(G),G.show("Click two points on the map...",1e10);var I=new x({source:new(0,l.default)({url:"https://viglino.github.io/ol-ext/examples/data/ROUTE120.geojson",format:new(0,d.default)})});const O={A:1/120,P:.0125,R:1/70,L:1/60};I.weight=function(t){var e=t?t.get("type"):"A";return O[e]||console.error(e),O[e]||O.L},I.direction=function(t){return t.get("dir")},I.getLength=function(t){return t.getGeometry&&(t=t.getGeometry()),(0,f.getLength)(t)};var D=new(0,a.default)({title:"Nodes",source:I.getNodeSource(),style:new(0,h.default)({image:new(0,c.default)({radius:5,fill:new(0,g.default)({color:[255,0,0,.1]})})})});setTimeout((()=>r.default.addLayer(D)));const F=new(0,l.default);setTimeout((()=>{r.default.addLayer(new(0,a.default)({source:F,style:new(0,h.default)({stroke:new(0,u.default)({width:2,color:"#f00"})})}))})),I.on("pause",(function(t){t.overflow&&I.resume()})),I.on("start",(function(t){G.show("Calculating...",1e10),F.clear()})),I.on("finish",(function(t){if(G.hide(),F.clear(),console.log(t),t.route.length){var e=(t.distance/1e3).toFixed(2)+" km",s=t.wDistance/1e3,i=Math.round(t.wDistance%1e3/1e3*60);i<10&&(i="0"+i),e+="<br/>"+s.toFixed(0)+" h "+i+" mn",G.show(e,1e4)}else t.wDistance,G.show("No route found...");F.addFeatures(t.route),I.set("start",I.get("end")),k.show(I.get("start")),T.hide()}));var R=I;(0,o("jZUWm").default)(t('<div> <h2> Day 6: network </h2> <p> Use <a href="http://viglino.github.io/ol-ext/doc/doc-pages/ol.graph.Dijskra.html" target="_new"> ol-ext Dijsktra graph </a> to calculate short path on a network. </p> <p> <img src="https://upload.wikimedia.org/wikipedia/commons/1/18/Logo-licence-ouverte2.svg"> <img src="https://static.data.gouv.fr/avatars/1b/e4985396724faf9f6e1122baa7b65c.gif"> The graph used in this example is <a href="https://www.data.gouv.fr/fr/datasets/route-120/" target="_new">ROUTE 120Â®</a>, an opensource (Open licence) database from IGN-France. </p> </div>'));const S=new(0,n.default)({layer:"GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2"});r.default.addLayer(S),r.default.getView().setZoom(6),r.default.getView().setCenter([256551,5905459]),r.default.addLayer(new(0,a.default)({title:"Graph",source:R.source})),r.default.on("click",(t=>{console.log(t,k),R.get("start")?(T.show(t.coordinate),setTimeout((function(){var e=R.path(R.get("start"),t.coordinate);e?(R.set("start",e[0]),R.set("end",e[1])):T.hide()}),100)):(R.set("start",t.coordinate),k.show(R.get("start")))}));
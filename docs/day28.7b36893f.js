function e(e){return e&&e.__esModule?e.default:e}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i={},r={},a=t.parcelRequirecc54;null==a&&((a=function(e){if(e in i)return i[e].exports;if(e in r){var t=r[e];delete r[e];var a={id:e,exports:{}};return i[e]=a,t.call(a.exports,a,a.exports),a.exports}var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){r[e]=t},t.parcelRequirecc54=a);var o=a("6gELa");a("gvREW");var n=a("1B70O"),s=a("jZUWm");var l=a("37u5y"),h=a("610XN"),g=(h=a("610XN"),a("ejLRd")),u=a("jZ9vT"),f=a("fnScq"),d=a("l9IGS"),c=a("d5AAH"),p=a("2zf1Y"),m=a("lqNjm"),_=a("23ytq");h.default.prototype.setRender3D=function(e){e.setLayer(this)};var y=class extends f.default{constructor(e){(e=e||{}).maxResolution=e.maxResolution||100,e.defaultHeight=e.defaultHeight||0,super(e),this.setStyle(e.style),this.set("ghost",e.ghost),this.setActive(e.active||!1!==e.active),this.height_=e.height=this.getHfn(e.height),e.layer&&this.setLayer(e.layer)}setStyle(e){if(e instanceof d.default?this._style=e:this._style=new(0,d.default),this._style.getStroke()||this._style.setStroke(new(0,c.default)({width:1,color:"red"})),this._style.getFill()||this._style.setFill(new(0,p.default)({color:"rgba(0,0,255,0.5)"})),e&&e.getGeometry()){var t=e.getGeometry();"function"==typeof t?this.set("geometry",t):this.set("geometry",(function(){return t}))}else this.set("geometry",(function(e){return e.getGeometry()}))}getStyle(){return this._style}setActive(e){this._active="function"==typeof e?e:function(){return e},this.layer_&&this.layer_.changed()}getActive(){return this._active()}onPostcompose_(e){if(this.getActive()){var t=e.frameState.viewState.resolution;if(!(t>this.get("maxResolution"))){if(this.res_=400*t,this.animate_){var i=e.frameState.time-this.animate_;i<this.animateDuration_?(this.elapsedRatio_=this.easing_(i/this.animateDuration_),e.frameState.animate=!0):(this.animate_=!1,this.height_=this.toHeight_)}var r=e.frameState.pixelRatio,a=e.context,o=this.matrix_=e.frameState.coordinateToPixelTransform;o||((o=e.frameState.coordinateToPixelMatrix)[2]=o[4],o[3]=o[5],o[4]=o[12],o[5]=o[13]),this.center_=[a.canvas.width/2/r,a.canvas.height/r];var n=this.layer_.getSource().getFeaturesInExtent(e.frameState.extent);a.save(),a.scale(r,r);var s=this.getStyle();a.lineWidth=s.getStroke().getWidth(),a.strokeStyle=(0,m.asString)(s.getStroke().getColor()),a.fillStyle=(0,m.asString)(s.getFill().getColor());for(var l=[],h=0;h<n.length;h++){var g=this.getFeatureHeight(n[h]);g&&l.push(this.getFeature3D_(n[h],g))}this.get("ghost")?this.drawGhost3D_(a,l):this.drawFeature3D_(a,l),a.restore()}}}setLayer(e){this._listener&&this._listener.forEach((function(e){(0,g.unByKey)(e)})),this.layer_=e,this._listener=e.on(["postcompose","postrender"],this.onPostcompose_.bind(this))}getHfn(e){switch(typeof e){case"function":return e;case"string":var t=this.get("defaultHeight");return function(i){return Number(i.get(e))||t};case"number":return function(){return e};default:return function(){return 10}}}animate(e){e=e||{},this.toHeight_=this.getHfn(e.height),this.animate_=(new Date).getTime(),this.animateDuration_=e.duration||1e3,this.easing_=e.easing||u.easeOut,this.layer_.changed()}animating(){return this.animate_&&(new Date).getTime()-this.animate_>this.animateDuration_&&(this.animate_=!1),!!this.animate_}getFeatureHeight(e){if(this.animate_){var t=this.height_(e),i=this.toHeight_(e);return t*(1-this.elapsedRatio_)+this.elapsedRatio_*i}return this.height_(e)}hvector_(e,t){var i=[e[0]*this.matrix_[0]+e[1]*this.matrix_[1]+this.matrix_[4],e[0]*this.matrix_[2]+e[1]*this.matrix_[3]+this.matrix_[5]];return{p0:i,p1:[i[0]+t/this.res_*(i[0]-this.center_[0]),i[1]+t/this.res_*(i[1]-this.center_[1])]}}getFeature3D_(e,t){var i=this.get("geometry")(e),r=i.getCoordinates();switch(i.getType()){case"Polygon":r=[r];case"MultiPolygon":for(var a=[],o=0;o<r.length;o++)for(var n=0;n<r[o].length;n++){for(var s=[],l=0;l<r[o][n].length;l++)s.push(this.hvector_(r[o][n][l],t));a.push(s)}return{type:"MultiPolygon",feature:e,geom:a,height:t};case"Point":return{type:"Point",feature:e,geom:this.hvector_(r,t),height:t};default:return{}}}drawFeature3D_(e,t){var i,r,a,o;for(i=0;i<t.length;i++)switch(t[i].type){case"MultiPolygon":for(r=0;r<t[i].geom.length;r++)for(a=t[i].geom[r],o=0;o<a.length;o++)e.beginPath(),e.moveTo(a[o].p0[0],a[o].p0[1]),e.lineTo(a[o].p1[0],a[o].p1[1]),e.stroke();break;case"Point":var n=t[i].geom;e.beginPath(),e.moveTo(n.p0[0],n.p0[1]),e.lineTo(n.p1[0],n.p1[1]),e.stroke()}for(i=0;i<t.length;i++)switch(t[i].type){case"MultiPolygon":for(e.beginPath(),r=0;r<t[i].geom.length;r++){if(a=t[i].geom[r],0==r)for(e.moveTo(a[0].p1[0],a[0].p1[1]),o=1;o<a.length;o++)e.lineTo(a[o].p1[0],a[o].p1[1]);else for(e.moveTo(a[0].p1[0],a[0].p1[1]),o=a.length-2;o>=0;o--)e.lineTo(a[o].p1[0],a[o].p1[1]);e.closePath()}e.fill("evenodd"),e.stroke();break;case"Point":var s=(a=t[i]).feature.get("label");if(s){var l=a.geom.p1,h=e.fillStyle;e.fillStyle=e.strokeStyle,e.textAlign="center",e.textBaseline="bottom",e.fillText(s,l[0],l[1]);var g=e.measureText(s),u=Number(e.font.match(/\d+(\.\d+)?/g).join([]));e.fillStyle="rgba(255,255,255,0.5)",e.fillRect(l[0]-g.width/2-5,l[1]-u-5,g.width+10,u+10),e.strokeRect(l[0]-g.width/2-5,l[1]-u-5,g.width+10,u+10),e.fillStyle=h}}}drawGhost3D_(e,t){var i,r,a,o;for(i=0;i<t.length;i++)switch(t[i].type){case"MultiPolygon":for(r=0;r<t[i].geom.length;r++)for(a=t[i].geom[r],o=0;o<a.length-1;o++){e.beginPath(),e.moveTo(a[o].p0[0],a[o].p0[1]),e.lineTo(a[o].p1[0],a[o].p1[1]),e.lineTo(a[o+1].p1[0],a[o+1].p1[1]),e.lineTo(a[o+1].p0[0],a[o+1].p0[1]),e.lineTo(a[o].p0[0],a[o].p0[1]);var n=[(a[o].p0[0]+a[o+1].p0[0])/2,(a[o].p0[1]+a[o+1].p0[1])/2],s=[a[o].p0[1]-a[o+1].p0[1],-a[o].p0[0]+a[o+1].p0[0]],l=(0,_.ol_coordinate_getIntersectionPoint)([n,[n[0]+s[0],n[1]+s[1]]],[a[o].p1,a[o+1].p1]),h=e.createLinearGradient(n[0],n[1],l[0],l[1]);h.addColorStop(0,"rgba(255,255,255,.2)"),h.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=h,e.fill()}break;case"Point":var g=t[i].geom;e.beginPath(),e.moveTo(g.p0[0],g.p0[1]),e.lineTo(g.p1[0],g.p1[1]),e.stroke()}}};(0,s.default)(e('<div> <h2> Day 28: 3D </h2> <p> Display buildings height (IGN BDTopo&reg;) using <a href="http://viglino.github.io/ol-ext/doc/doc-pages/ol.render3D.html" target="_new">ol-ext render 3D (2.5D)</a>. </p> </div>')),n.default.getView().setZoom(17.2),n.default.getView().setCenter([-187893,6120701]);const v=new(0,o.default)({layer:"GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2"});n.default.addLayer(v);var w=new(0,l.default)({url:"https://data.geopf.fr/wfs/ows",typeName:"BDTOPO_V3:batiment",tileZoom:16});const S=new(0,h.default)({title:"Buildings",source:w,maxResolution:3,declutter:!0});n.default.addLayer(S);var x=new y({height:function(e){return e.get("hauteur")/1.5},active:!0,maxResolution:2,defaultHeight:3.5});S.setRender3D(x);
function t(t){return t&&t.__esModule?t.default:t}var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},o={},r={},i=e.parcelRequirecc54;null==i&&((i=function(t){if(t in o)return o[t].exports;if(t in r){var e=r[t];delete r[t];var i={id:t,exports:{}};return o[t]=i,e.call(i.exports,i,i.exports),i.exports}var s=new Error("Cannot find module '"+t+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(t,e){r[t]=e},e.parcelRequirecc54=i);var s=i("7qsnY"),a=i("20LS2"),n=i("6gELa"),l=i("kPMpK"),h=i("l9IGS"),f=i("lqNjm"),d=(f=i("lqNjm"),i("23ytq"));d=i("23ytq");(v=i("hvEnP")).default.prototype.splitAt=function(t,e){var o;if(!t)return[this];if(e||(e=1e-10),t.length&&t[0].length){var r=[this];for(o=0;o<t.length;o++){for(var i=[],s=0;s<r.length;s++){var a=r[s].splitAt(t[o],e);i=i.concat(a)}r=i}return r}if((0,d.ol_coordinate_equal)(t,this.getFirstCoordinate())||(0,d.ol_coordinate_equal)(t,this.getLastCoordinate()))return[this];var n=this.getCoordinates(),l=[n[0]],h=[];for(o=0;o<n.length-1;o++)if(!(0,d.ol_coordinate_equal)(n[o],n[o+1])){if((0,d.ol_coordinate_equal)(t,n[o+1]))l.push(n[o+1]),h.push(new(0,v.default)(l)),l=[];else if(!(0,d.ol_coordinate_equal)(t,n[o])){var f,u,c=!1;n[o][0]==n[o+1][0]?(f=(n[o][1]-t[1])/(n[o][1]-n[o+1][1]),c=n[o][0]==t[0]&&0<f&&f<=1):n[o][1]==n[o+1][1]?(f=(n[o][0]-t[0])/(n[o][0]-n[o+1][0]),c=n[o][1]==t[1]&&0<f&&f<=1):(f=(n[o][0]-t[0])/(n[o][0]-n[o+1][0]),u=(n[o][1]-t[1])/(n[o][1]-n[o+1][1]),c=Math.abs(f-u)<=e&&0<f&&f<=1),c&&(l.push(t),h.push(new(0,v.default)(l)),l=[t])}l.push(n[o+1])}return l.length>1&&h.push(new(0,v.default)(l)),h.length?h:[this]};var u=class extends h.default{constructor(t){super({stroke:(t=t||{}).stroke,text:t.text,zIndex:t.zIndex,geometry:t.geometry}),this.setRenderer(this._render.bind(this)),this._visible=!1!==t.visible,"function"==typeof t.width?this._widthFn=t.width:this.setWidth(t.width),this.setWidth2(t.width2),"function"==typeof t.color?this._colorFn=t.color:this.setColor(t.color),this.setColor2(t.color2),this.setLineCap(t.lineCap),this.setArrow(t.arrow),this.setArrowSize(t.arrowSize),this.setArrowColor(t.arrowColor),this._offset=[0,0],this.setOffset(t.offset0,0),this.setOffset(t.offset1,1),this._noOverlap=t.noOverlap}setWidth(t){this._width=t||0}setWidth2(t){this._width2=t}getOffset(t){return this._offset[t]}setOffset(t,e){switch(t=Math.max(0,parseFloat(t)),e){case 0:this._offset[0]=t;break;case 1:this._offset[1]=t}}setLineCap(t){this._lineCap="round"===t?"round":"butt"}getWidth(t,e){if(this._widthFn)return this._widthFn(t,e);var o="number"==typeof this._width2?this._width2:this._width;return this._width+(o-this._width)*e}setColor(t){try{this._color=(0,f.asArray)(t)}catch(t){this._color=[0,0,0,1]}}setColor2(t){try{this._color2=(0,f.asArray)(t)}catch(t){this._color2=null}}setArrowColor(t){try{this._acolor=(0,f.asString)(t)}catch(t){this._acolor=null}}getColor(t,e){if(this._colorFn)return(0,f.asString)(this._colorFn(t,e));var o=this._color,r=this._color2||this._color;return"rgba("+ +Math.round(o[0]+(r[0]-o[0])*e)+","+Math.round(o[1]+(r[1]-o[1])*e)+","+Math.round(o[2]+(r[2]-o[2])*e)+","+(o[3]+(r[3]-o[3])*e)+")"}getArrow(){return this._arrow}setArrow(t){this._arrow=parseInt(t),(this._arrow<-1||this._arrow>2)&&(this._arrow=0)}getArrowSize(){return this._arrowSize||[16,16]}setArrowSize(t){Array.isArray(t)?this._arrowSize=t:"number"==typeof t&&(this._arrowSize=[t,t])}drawArrow(t,e,o,r,i){var s=this.getArrowSize()[0]*i,a=(0,d.ol_coordinate_dist2d)(e,o),n=(e[0]-o[0])/a,l=(e[1]-o[1])/a;r=Math.max(this.getArrowSize()[1]/2,r/2)*i,t.beginPath(),t.moveTo(e[0],e[1]),t.lineTo(e[0]-s*n+r*l,e[1]-s*l-r*n),t.lineTo(e[0]-s*n-r*l,e[1]-s*l+r*n),t.lineTo(e[0],e[1]),t.fill()}_render(t,e){if("LineString"===e.geometry.getType()){var o,r,i,s=e.context;if(!this._visible){var a=e.pixelRatio/e.resolution,n=Math.cos(e.rotation),l=Math.sin(e.rotation);r=e.geometry.getCoordinates();var h=t[0][0]-r[0][0]*a*n-r[0][1]*a*l,f=t[0][1]-r[0][0]*a*l+r[0][1]*a*n;for(t=[],o=0;i=r[o];o++)t[o]=[h+i[0]*a*n+i[1]*a*l,f+i[0]*a*l-i[1]*a*n,i[2]]}var d=this.getArrowSize()[0]*e.pixelRatio;s.save(),this.getOffset(0)&&this._splitAsize(t,this.getOffset(0)*e.pixelRatio),this.getOffset(1)&&this._splitAsize(t,this.getOffset(1)*e.pixelRatio,!0),t.length>1&&(-1===this.getArrow()||2===this.getArrow())&&(i=this._splitAsize(t,d),this._acolor?s.fillStyle=this._acolor:s.fillStyle=this.getColor(e.feature,0),this.drawArrow(s,i[0],i[1],this.getWidth(e.feature,0),e.pixelRatio)),t.length>1&&this.getArrow()>0&&(i=this._splitAsize(t,d,!0),this._acolor?s.fillStyle=this._acolor:s.fillStyle=this.getColor(e.feature,1),this.drawArrow(s,i[0],i[1],this.getWidth(e.feature,1),e.pixelRatio));var u=this._splitInto(t,255,2),c=0,g=u.length;if(s.lineJoin="round",s.lineCap=this._lineCap||"butt",u.length>1)for(c=0;c<u.length;c++){var w=c/g;for(r=u[c],s.lineWidth=this.getWidth(e.feature,w)*e.pixelRatio,s.strokeStyle=this.getColor(e.feature,w),s.beginPath(),s.moveTo(r[0][0],r[0][1]),o=1;i=r[o];o++)s.lineTo(i[0],i[1]);s.stroke()}s.restore()}}_splitAsize(t,e,o){var r,i,s,a,n=0;for(r=s=o?t.pop():t.shift();t.length;){if(i=o?t.pop():t.shift(),n+(a=(0,d.ol_coordinate_dist2d)(r,i))>e){r=[r[0]+(i[0]-r[0])*(e-n)/a,r[1]+(i[1]-r[1])*(e-n)/a],a=(0,d.ol_coordinate_dist2d)(r,s),o?(t.push(i),t.push(r),t.push([r[0]+(s[0]-r[0])/a,r[1]+(s[1]-r[1])/a])):(t.unshift(i),t.unshift(r),t.unshift([r[0]+(s[0]-r[0])/a,r[1]+(s[1]-r[1])/a]));break}n+=a,r=i}return[s,r]}_splitInto(t,e,o){var r,i,s,a=this._noOverlap?1:.9,n=[],l=0;for(r=1;i=t[r];r++)l+=(0,d.ol_coordinate_dist2d)(t[r-1],i);var h=Math.max(o||2,l/(e||255)),f=t[0];l=0;var u=[f];for(r=1,i=t[1];r<t.length;){var c=i[0]-f[0],g=i[1]-f[1];if(l+(s=Math.sqrt(c*c+g*g))>h){var w=(h-l)/s;u.push([f[0]+c*w,f[1]+g*w]),n.push(u),u=[f=[f[0]+c*w*a,f[1]+g*w*a]],l=0}else l+=s,f=i,u.push(f),i=t[++r]}return n.push(u),n}},c=i("1B70O"),g=i("jZUWm");var w=i("ejLRd"),p=i("fkmMz"),_=i("6yJ0x"),y=i("iGyOD"),v=i("hvEnP");(0,g.default)(t('<div> <h2> Day 2: lines Flow lines style </h2> <p> Use <a href="http://viglino.github.io/ol-ext/doc/doc-pages/ol.style.FlowLine.html" target="_new"> ol-ext FlowLine Style </a> to display professionnal mobility (<a href="https://www.insee.fr/fr/statistiques/4509353" target="_new"> INSEE data &copy; 2017 </a>) </p> </div>'));const x=new(0,n.default)({layer:"GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2"});c.default.addLayer(x),c.default.getView().setMinZoom(6),c.default.getView().setCenter([251333,5895217]);const S=new(0,s.default)({source:new(0,a.default)({url:"https://viglino.github.io/ol-ext/examples/data/departements.geojson",format:new(0,l.default),attributions:["&copy; <a href='https://www.insee.fr'>INSEE</a>","&copy; <a href='https://www.data.gouv.fr/fr/datasets/geofla-r/'>IGN</a>"]})});c.default.addLayer(S);const A={},m=S.getSource().on("change",(function(t){if((0,w.unByKey)(m),"ready"===S.getSource().getState()){let t;S.getSource().getFeatures().forEach((function(e){let o,r=e.getGeometry();if("41"===e.get("id")&&(t=e),r.getInteriorPoint)o=r.getInteriorPoint().getFirstCoordinate();else{var i=0;r.getPolygons().forEach((function(t){var e=t.getArea();i<e&&(i=e,o=t.getInteriorPoint().getFirstCoordinate())}))}A[e.get("id")]={xy:o,data:[]}})),p.default.get({url:"https://viglino.github.io/ol-ext/examples/data/mobilite-2017.csv",dataType:"CSV",success:function(t){(t=t.split("\n")).shift(),t.forEach((function(t){t=t.split(","),A[t[0]]&&A[t[1]]&&A[t[0]].data.push({dep:t[1],xy:A[t[1]].xy,flow:parseInt(t[2])})}))}}),setTimeout((function(){}),0)}}));const C=new(0,s.default)({source:new(0,a.default),style:function(t,e){return new u({color:"red",color2:"yellow",width:2,width2:t.get("flow"),offset0:10,arrow:1,zIndex:-t.getGeometry().getLastCoordinate()[1]})}});c.default.addLayer(C);var b=new(0,_.default)({cursor:"pointer",layers:[S]});c.default.addInteraction(b),b.on("enter",(function(t){const e=t.feature;if(C.getSource().clear(),e){const t=e.get("id"),o=A[t];o.data.forEach((function(e){if(e.flow>300&&e.dep!==t){const t=new(0,y.default)(new(0,v.default)([o.xy,e.xy]));t.set("flow",Math.max(2,Math.min(30,e.flow/300))),t.set("flux",e.flow.toLocaleString()),C.getSource().addFeature(t)}}))}})),b.on("leave",(function(t){C.getSource().clear()}));
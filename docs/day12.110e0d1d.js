function t(t){return t&&t.__esModule?t.default:t}var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i={},s={},r=e.parcelRequirecc54;null==r&&((r=function(t){if(t in i)return i[t].exports;if(t in s){var e=s[t];delete s[t];var r={id:t,exports:{}};return i[t]=r,e.call(r.exports,r,r.exports),r.exports}var a=new Error("Cannot find module '"+t+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(t,e){s[t]=e},e.parcelRequirecc54=r);var a=r("6gELa"),o=r("dMe05"),n=class extends o.default{constructor(t){super(t)}getExtent(){return this.getSource().getExtent()}},h=r("3QQdo"),l=r("50PZ9");class c extends h.default{constructor(t,e,i,s,r){super(t,e,i,void 0!==r?l.default.IDLE:l.default.LOADED),this.loader_=void 0!==r?r:null,this.canvas_=s,this.error_=null}getError(){return this.error_}handleLoad_(t){t?(this.error_=t,this.state=l.default.ERROR):this.state=l.default.LOADED,this.changed()}load(){this.state==l.default.IDLE&&(this.state=l.default.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}var u=c,g=r("iTTi2"),d=(l=r("50PZ9"),r("9ndmc")),_=r("cw4dl"),f=(h=r("3QQdo"),l=r("50PZ9"),r("9JHmh")),p=r("gpSXC"),m=r("jZquI"),v=r("bsgMw");class y extends h.default{constructor(t,e,i,s,r,a,o){const n=t.getExtent(),h=e.getExtent(),c=h?(0,m.getIntersection)(i,h):i,u=(0,m.getCenter)(c),g=(0,p.calculateSourceResolution)(t,e,u,s),_=d.ERROR_THRESHOLD,v=new(0,f.default)(t,e,c,n,g*_,s),y=a(v.calculateSourceExtent(),g,r),w=y?l.default.IDLE:l.default.EMPTY,E=y?y.getPixelRatio():1;super(i,s,E,w),this.targetProj_=e,this.maxSourceExtent_=n,this.triangulation_=v,this.targetResolution_=s,this.targetExtent_=i,this.sourceImage_=y,this.sourcePixelRatio_=E,this.interpolate_=o,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==l.default.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const t=this.sourceImage_.getState();if(t==l.default.LOADED){const t=(0,m.getWidth)(this.targetExtent_)/this.targetResolution_,e=(0,m.getHeight)(this.targetExtent_)/this.targetResolution_;this.canvas_=(0,p.render)(t,e,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_)}this.state=t,this.changed()}load(){if(this.state==l.default.IDLE){this.state=l.default.LOADING,this.changed();const t=this.sourceImage_.getState();t==l.default.LOADED||t==l.default.ERROR?this.reproject_():(this.sourceListenerKey_=(0,v.listen)(this.sourceImage_,_.default.CHANGE,(function(t){const e=this.sourceImage_.getState();e!=l.default.LOADED&&e!=l.default.ERROR||(this.unlistenSource_(),this.reproject_())}),this),this.sourceImage_.load())}}unlistenSource_(){(0,v.unlistenByKey)(this.sourceListenerKey_),this.sourceListenerKey_=null}}var w=y,E=r("205E0"),x=r("lVQul"),R=(m=r("jZquI"),r("gzr8q")),S=r("kBSVF");const I="imageloadstart",C="imageloadend",b="imageloaderror";class T extends g.default{constructor(t,e){super(t),this.image=e}}class P extends E.default{constructor(t){super({attributions:t.attributions,projection:t.projection,state:t.state,interpolate:void 0===t.interpolate||t.interpolate}),this.on,this.once,this.un,this.resolutions_=void 0!==t.resolutions?t.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0}getResolutions(){return this.resolutions_}findNearestResolution(t){if(this.resolutions_){const e=(0,S.linearFindNearest)(this.resolutions_,t,0);t=this.resolutions_[e]}return t}getImage(t,e,i,s){const r=this.getProjection();if(r&&s&&!(0,R.equivalent)(r,s)){if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&(0,R.equivalent)(this.reprojectedImage_.getProjection(),s)&&this.reprojectedImage_.getResolution()==e&&(0,m.equals)(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new w(r,s,t,e,i,function(t,e,i){return this.getImageInternal(t,e,i,r)}.bind(this),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}return r&&(s=r),this.getImageInternal(t,e,i,s)}getImageInternal(t,e,i,s){return(0,x.abstract)()}handleImageChange(t){const e=t.target;let i;switch(e.getState()){case l.default.LOADING:this.loading=!0,i=I;break;case l.default.LOADED:this.loading=!1,i=C;break;case l.default.ERROR:this.loading=!1,i=b;break;default:return}this.hasListener(i)&&this.dispatchEvent(new T(i,e))}}var L=P;m=r("jZquI");var G=class extends L{constructor(t){super({attributions:(t=t||{}).attributions,interpolate:t.interpolate,projection:t.projection,resolutions:t.resolutions,state:t.state}),this.canvasFunction_=t.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=void 0!==t.ratio?t.ratio:1.5}getImageInternal(t,e,i,s){e=this.findNearestResolution(e);let r=this.canvas_;if(r&&this.renderedRevision_==this.getRevision()&&r.getResolution()==e&&r.getPixelRatio()==i&&(0,m.containsExtent)(r.getExtent(),t))return r;t=t.slice(),(0,m.scaleFromCenter)(t,this.ratio_);const a=[(0,m.getWidth)(t)/e*i,(0,m.getHeight)(t)/e*i],o=this.canvasFunction_.call(this,t,e,i,a,s);return o&&(r=new u(t,e,i,o)),this.canvas_=r,this.renderedRevision_=this.getRevision(),r}},V=r("cgPpQ"),k=(m=r("jZquI"),V=r("cgPpQ"),class extends G{constructor(t){var e={attributions:t.attributions,logo:t.logo,projection:t.projection,canvasFunction:function(t,e,i,s){return this.calculateImage(t,e,i,s)}};super(e),this._image=t.image?t.image:new Image,this._image.crossOrigin=t.crossOrigin,this._image.onload=function(){this.setCrop(this.crop),this.changed()}.bind(this),t.image||(this._image.src=t.url),this.center=t.imageCenter,this.setScale(t.imageScale),this.rotate=t.imageRotate?t.imageRotate:0,this.crop=t.imageCrop,this.mask=t.imageMask,this.setCrop(this.crop),this.on("change",function(){this.set("extent",this.calculateExtent())}.bind(this))}calculateImage(t,e,i,s){if(this.center){var r=document.createElement("canvas");r.width=s[0],r.height=s[1];var a=r.getContext("2d");if(!this._imageSize)return r;if(this.mask){a.beginPath();var o=d(this.mask[0]);a.moveTo(o[0],o[1]);for(var n=1;n<this.mask.length;n++)o=d(this.mask[n]),a.lineTo(o[0],o[1]);a.clip()}var h=d(this.center),l=(this._image.naturalWidth/2-this.crop[0])*this.scale[0]/e*i,c=(this._image.naturalHeight/2-this.crop[1])*this.scale[1]/e*i,u=this._imageSize[0]*this.scale[0]/e*i,g=this._imageSize[1]*this.scale[1]/e*i;return a.translate(h[0],h[1]),this.rotate&&a.rotate(this.rotate),a.drawImage(this._image,this.crop[0],this.crop[1],this._imageSize[0],this._imageSize[1],-l,-c,u,g),r}function d(e){return[(e[0]-t[0])/(t[2]-t[0])*s[0],(e[1]-t[3])/(t[1]-t[3])*s[1]]}}getCenter(){return this.center}setCenter(t){this.center=t,this.changed()}getScale(){return this.scale}setScale(t){switch(typeof t){case"number":t=[t,t];break;case"object":if(2!=t.length)return;break;default:return}this.scale=t,this.changed()}getRotation(){return this.rotate}setRotation(t){this.rotate=t,this.changed()}getGeoImage(){return this._image}getCrop(){return this.crop}setMask(t){this.mask=t,this.changed()}getMask(){return this.mask}setCrop(t){if(this._image.naturalWidth){if(t){switch(typeof t){case"number":t=[t,t,this._image.naturalWidth-t,this._image.naturalHeight-t];break;case"object":if(4!=t.length)return;break;default:return}t=(0,m.boundingExtent)([[t[0],t[1]],[t[2],t[3]]]),this.crop=[Math.max(0,t[0]),Math.max(0,t[1]),Math.min(this._image.naturalWidth,t[2]),Math.min(this._image.naturalHeight,t[3])]}else this.crop=[0,0,this._image.naturalWidth,this._image.naturalHeight];this.crop[2]<=this.crop[0]&&(this.crop[2]=this.crop[0]+1),this.crop[3]<=this.crop[1]&&(this.crop[3]=this.crop[1]+1),this._imageSize=[this.crop[2]-this.crop[0],this.crop[3]-this.crop[1]],this.changed()}else this.crop=t}getExtent(t){var e=this.get("extent");if(e||(e=this.calculateExtent()),t)for(var i=0;i<t.length;i++)t[i]=e[i];return e}calculateExtent(t){var e;if(!1!==t&&this.getMask())e=new(0,V.default)([this.getMask()]);else{var i=this.getCenter(),s=this.getScale(),r=this.getGeoImage().width*s[0],a=this.getGeoImage().height*s[1],o=(0,m.boundingExtent)([[i[0]-r/2,i[1]-a/2],[i[0]+r/2,i[1]+a/2]]);(e=(0,V.fromExtent)(o)).rotate(-this.getRotation(),i)}return e.getExtent()}}),j=(V=r("cgPpQ"),m=r("jZquI"),r("610XN")),A=r("20LS2"),M=r("iGyOD"),O=r("l9IGS"),D=r("d5AAH"),F=(A=r("20LS2"),r("2zf1Y")),N=(j=r("610XN"),r("j2K3b")),z=(M=r("iGyOD"),r("31ZqB")),Z=r("pMeEw"),q=r("h6Aha"),H=(V=r("cgPpQ"),m=r("jZquI"),r("ejLRd")),B=(V=r("cgPpQ"),class extends Z.default{constructor(t){t=t||{},super({handleDownEvent:function(t){return e.handleDownEvent_(t)},handleDragEvent:function(t){return this.handleDragEvent_(t)},handleMoveEvent:function(t){return this.handleMoveEvent_(t)},handleUpEvent:function(t){return this.handleUpEvent_(t)}});var e=this;this.selection_=new(0,z.default),this.handles_=new(0,z.default),this.overlayLayer_=new(0,j.default)({source:new(0,A.default)({features:this.handles_,useSpatialIndex:!1,wrapX:!1}),name:"Transform overlay",displayInLayerSwitcher:!1,style:function(t){return e.style[(t.get("handle")||"default")+(t.get("constraint")||"")+(t.get("option")||"")]}}),this.features_=t.features,"function"==typeof t.filter&&(this._filter=t.filter),this.layers_=t.layers?t.layers instanceof Array?t.layers:[t.layers]:null,this._handleEvent=t.condition||function(){return!0},this.addFn_=t.addCondition||function(){return!1},this.setPointRadius(t.pointRadius),this.set("translateFeature",!1!==t.translateFeature),this.set("translate",!1!==t.translate),this.set("translateBBox",!0===t.translateBBox),this.set("stretch",!1!==t.stretch),this.set("scale",!1!==t.scale),this.set("rotate",!1!==t.rotate),this.set("keepAspectRatio",t.keepAspectRatio||function(t){return t.originalEvent.shiftKey}),this.set("modifyCenter",t.modifyCenter||function(t){return t.originalEvent.metaKey||t.originalEvent.ctrlKey}),this.set("noFlip",t.noFlip||!1),this.set("selection",!1!==t.selection),this.set("hitTolerance",t.hitTolerance||0),this.set("enableRotatedTransform",t.enableRotatedTransform||!1),this.set("keepRectangle",t.keepRectangle||!1),this.on("propertychange",(function(){this.drawSketch_()})),this.setDefaultStyle()}setMap(t){var e=this.getMap();if(e){var i=e.getTargetElement();e.removeLayer(this.overlayLayer_),this.previousCursor_&&i&&(i.style.cursor=this.previousCursor_),this.previousCursor_=void 0}super.setMap(t),this.overlayLayer_.setMap(t),null===t&&this.select(null),null!==t&&(this.isTouch=/touch/.test(t.getViewport().className),this.setDefaultStyle())}setActive(t){this.select(null),this.overlayLayer_&&this.overlayLayer_.setVisible(t),super.setActive(t)}setDefaultStyle(t){var e=(t=t||{}).pointStroke||new(0,D.default)({color:[255,0,0,1],width:1}),i=t.stroke||new(0,D.default)({color:[255,0,0,1],width:1,lineDash:[4,4]}),s=t.fill||new(0,F.default)({color:[255,0,0,.01]}),r=t.pointFill||new(0,F.default)({color:[255,255,255,.8]}),a=new(0,q.default)({fill:r,stroke:e,radius:this.isTouch?12:6,displacement:this.isTouch?[24,-24]:[12,-12],points:15});a.setDisplacement||(a.getAnchor()[0]=this.isTouch?-10:-5);var o=new(0,q.default)({fill:r,stroke:e,radius:this.isTouch?16:8,points:4,angle:Math.PI/4}),n=new(0,q.default)({fill:r,stroke:e,radius:this.isTouch?12:6,points:4,angle:Math.PI/4});function h(t,e,i){return[new(0,O.default)({image:t,stroke:e,fill:i})]}this.style={default:h(o,i,s),translate:h(o,e,r),rotate:h(a,e,r),rotate0:h(o,e,r),scale:h(o,e,r),scale1:h(o,e,r),scale2:h(o,e,r),scale3:h(o,e,r),scalev:h(n,e,r),scaleh1:h(n,e,r),scalev2:h(n,e,r),scaleh3:h(n,e,r)},this.drawSketch_()}setStyle(t,e){if(e){this.style[t]=e instanceof Array?e:[e];for(var i=0;i<this.style[t].length;i++){var s=this.style[t][i].getImage();s&&("rotate"==t&&(s.getAnchor()[0]=-5),this.isTouch&&s.setScale(1.8));var r=this.style[t][i].getText();r&&("rotate"==t&&r.setOffsetX(this.isTouch?14:7),this.isTouch&&r.setScale(1.8))}this.drawSketch_()}}getFeatureAtPixel_(t){var e=this;return this.getMap().forEachFeatureAtPixel(t,(function(t,i){var s=!1;if(!i){if(t===e.bbox_)return!!e.get("translateBBox")&&{feature:t,handle:"translate",constraint:"",option:""};if(e.handles_.forEach((function(e){e===t&&(s=!0)})),s)return{feature:t,handle:t.get("handle"),constraint:t.get("constraint"),option:t.get("option")}}if(!e.get("selection"))return e.selection_.getArray().some((function(e){return t===e}))?{feature:t}:null;if(e._filter)return e._filter(t,i)?{feature:t}:null;if(e.layers_){for(var r=0;r<e.layers_.length;r++)if(e.layers_[r]===i)return{feature:t};return null}return e.features_?(e.features_.forEach((function(e){e===t&&(s=!0)})),s?{feature:t}:null):{feature:t}}),{hitTolerance:this.get("hitTolerance")})||{}}getGeometryRotateToZero_(t,e){var i=t.getGeometry(),s=this.getMap().getView().getRotation();if(0===s||!this.get("enableRotatedTransform"))return e?i.clone():i;var r=i.clone();return r.rotate(-1*s,this.getMap().getView().getCenter()),r}_isRectangle(t){return!(!this.get("keepRectangle")||"Polygon"!==t.getType())&&5===t.getCoordinates()[0].length}drawSketch_(t){var e,i,s,r=this.selection_.item(0)&&this._isRectangle(this.selection_.item(0).getGeometry());if(this.overlayLayer_.getSource().clear(),this.selection_.getLength()){var a,o=this.getMap().getView().getRotation(),n=this.getGeometryRotateToZero_(this.selection_.item(0)).getExtent();r&&(a=this.getGeometryRotateToZero_(this.selection_.item(0)).getCoordinates()[0].slice(0,4)).unshift(a[3]),n=(0,m.buffer)(n,0),this.selection_.forEach(function(t){var e=this.getGeometryRotateToZero_(t).getExtent();(0,m.extend)(n,e)}.bind(this));var h=1===this.selection_.getLength()?this._pointRadius(this.selection_.item(0)):0;if(!h||h instanceof Array||(h=[h,h]),!0===t)this.ispt_||(this.overlayLayer_.getSource().addFeature(new(0,M.default)({geometry:new(0,N.default)(this.center_),handle:"rotate0"})),s=(0,V.fromExtent)(n),this.get("enableRotatedTransform")&&0!==o&&s.rotate(o,this.getMap().getView().getCenter()),i=this.bbox_=new(0,M.default)(s),this.overlayLayer_.getSource().addFeature(i));else{if(this.ispt_){var l=this.getMap().getPixelFromCoordinate([n[0],n[1]]);if(l){var c=h&&h[0]||10,u=h&&h[1]||10;n=(0,m.boundingExtent)([this.getMap().getCoordinateFromPixel([l[0]-c,l[1]-u]),this.getMap().getCoordinateFromPixel([l[0]+c,l[1]+u])])}}s=r?new(0,V.default)([a]):(0,V.fromExtent)(n),this.get("enableRotatedTransform")&&0!==o&&s.rotate(o,this.getMap().getView().getCenter()),i=this.bbox_=new(0,M.default)(s);var g=[],d=s.getCoordinates()[0];if(!this.ispt_||h){if(g.push(i),!this.iscircle_&&!this.ispt_&&this.get("stretch")&&this.get("scale"))for(e=0;e<d.length-1;e++)i=new(0,M.default)({geometry:new(0,N.default)([(d[e][0]+d[e+1][0])/2,(d[e][1]+d[e+1][1])/2]),handle:"scale",constraint:e%2?"h":"v",option:e}),g.push(i);if(this.get("scale"))for(e=0;e<d.length-1;e++)i=new(0,M.default)({geometry:new(0,N.default)(d[e]),handle:"scale",option:e}),g.push(i);this.get("translate")&&!this.get("translateFeature")&&(i=new(0,M.default)({geometry:new(0,N.default)([(d[0][0]+d[2][0])/2,(d[0][1]+d[2][1])/2]),handle:"translate"}),g.push(i))}!this.iscircle_&&this.get("rotate")&&(i=new(0,M.default)({geometry:new(0,N.default)(d[3]),handle:"rotate"}),g.push(i)),this.overlayLayer_.getSource().addFeatures(g)}}}select(t,e){if(t){if(t.getGeometry&&t.getGeometry()){if(e)this.selection_.push(t);else{var i=this.selection_.getArray().indexOf(t);this.selection_.removeAt(i)}this.ispt_=1===this.selection_.getLength()&&"Point"==this.selection_.item(0).getGeometry().getType(),this.iscircle_=1===this.selection_.getLength()&&"Circle"==this.selection_.item(0).getGeometry().getType(),this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",feature:t,features:this.selection_})}}else this.selection_&&(this.selection_.clear(),this.drawSketch_())}setSelection(t){this.selection_.clear(),t.forEach(function(t){this.selection_.push(t)}.bind(this)),this.ispt_=1===this.selection_.getLength()&&"Point"==this.selection_.item(0).getGeometry().getType(),this.iscircle_=1===this.selection_.getLength()&&"Circle"==this.selection_.item(0).getGeometry().getType(),this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",features:this.selection_})}watchFeatures_(){this._featureListeners&&this._featureListeners.forEach((function(t){(0,H.unByKey)(t)})),this._featureListeners=[],this.selection_.forEach(function(t){this._featureListeners.push(t.on("change",function(){this.isUpdating_||this.drawSketch_()}.bind(this)))}.bind(this))}handleDownEvent_(t){if(this._handleEvent(t,this.selection_)){var e=this.getFeatureAtPixel_(t.pixel),i=e.feature;if(this.selection_.getLength()&&this.selection_.getArray().indexOf(i)>=0&&(this.ispt_&&this.get("translate")||this.get("translateFeature"))&&(e.handle="translate"),e.handle){this.mode_=e.handle,this.opt_=e.option,this.constraint_=e.constraint;var s=this.getMap().getView().getRotation();this.coordinate_=t.coordinate,this.pixel_=t.pixel,this.geoms_=[],this.rotatedGeoms_=[];for(var r,a=(0,m.createEmpty)(),o=(0,m.createEmpty)(),n=0;r=this.selection_.item(n);n++)if(this.geoms_.push(r.getGeometry().clone()),a=(0,m.extend)(a,r.getGeometry().getExtent()),this.get("enableRotatedTransform")&&0!==s){var h=this.getGeometryRotateToZero_(r,!0);this.rotatedGeoms_.push(h),o=(0,m.extend)(o,h.getExtent())}if(this.extent_=(0,V.fromExtent)(a).getCoordinates()[0],this.get("enableRotatedTransform")&&0!==s&&(this.rotatedExtent_=(0,V.fromExtent)(o).getCoordinates()[0]),"rotate"===this.mode_){this.center_=this.getCenter()||(0,m.getCenter)(a);var l=t.map.getTargetElement();l.style.cursor=this.Cursors.rotate0,this.previousCursor_=l.style.cursor}else this.center_=(0,m.getCenter)(a);return this.angle_=Math.atan2(this.center_[1]-t.coordinate[1],this.center_[0]-t.coordinate[0]),this.dispatchEvent({type:this.mode_+"start",feature:this.selection_.item(0),features:this.selection_,pixel:t.pixel,coordinate:t.coordinate}),!0}if(this.get("selection")){if(i){this.addFn_(t)||this.selection_.clear();var c=this.selection_.getArray().indexOf(i);c<0?this.selection_.push(i):this.selection_.removeAt(c)}else this.selection_.clear();return this.ispt_=1===this.selection_.getLength()&&"Point"==this.selection_.item(0).getGeometry().getType(),this.iscircle_=1===this.selection_.getLength()&&"Circle"==this.selection_.item(0).getGeometry().getType(),this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",feature:i,features:this.selection_,pixel:t.pixel,coordinate:t.coordinate}),!1}}}getCenter(){return this.get("center")}setCenter(t){return this.set("center",t)}handleDragEvent_(t){if(this._handleEvent(t,this.features_)){var e,i,s,r,a=this.getMap().getView().getRotation(),o=[this.coordinate_[0],this.coordinate_[1]],n=[t.coordinate[0],t.coordinate[1]];switch(this.isUpdating_=!0,this.mode_){case"rotate":var h=Math.atan2(this.center_[1]-n[1],this.center_[0]-n[0]);if(!this.ispt)for(e=0;s=this.selection_.item(e);e++)(r=this.geoms_[e].clone()).rotate(h-this.angle_,this.center_),"Circle"==r.getType()&&r.setCenterAndRadius(r.getCenter(),r.getRadius()),s.setGeometry(r);this.drawSketch_(!0),this.dispatchEvent({type:"rotating",feature:this.selection_.item(0),features:this.selection_,angle:h-this.angle_,pixel:t.pixel,coordinate:t.coordinate});break;case"translate":var l=n[0]-o[0],c=n[1]-o[1];for(e=0;s=this.selection_.item(e);e++)s.getGeometry().translate(l,c);this.handles_.forEach((function(t){t.getGeometry().translate(l,c)})),this.coordinate_=t.coordinate,this.dispatchEvent({type:"translating",feature:this.selection_.item(0),features:this.selection_,delta:[l,c],pixel:t.pixel,coordinate:t.coordinate});break;case"scale":var u=this.center_;if(this.get("modifyCenter")(t)){var g=this.extent_;this.get("enableRotatedTransform")&&0!==a&&(g=this.rotatedExtent_),u=g[(Number(this.opt_)+2)%4]}var d=1==this.geoms_.length&&this._isRectangle(this.geoms_[0]),_=this.constraint_,f=this.opt_,p=this.coordinate_,m=t.coordinate;if(this.get("enableRotatedTransform")&&0!==a){var v=new(0,N.default)(this.coordinate_);v.rotate(-1*a,u),p=v.getCoordinates();var y=new(0,N.default)(t.coordinate);y.rotate(-1*a,u),m=y.getCoordinates()}var w=(m[0]-u[0])/(p[0]-u[0]),E=(m[1]-u[1])/(p[1]-u[1]),x=[m[0]-p[0],m[1]-p[1]];if(this.get("enableRotatedTransform")&&0!==a){var R=new(0,N.default)(u);R.rotate(-1*a,this.getMap().getView().getCenter()),u=R.getCoordinates()}for(this.get("noFlip")&&(w<0&&(w=-w),E<0&&(E=-E)),this.constraint_?"h"==this.constraint_?w=1:E=1:this.get("keepAspectRatio")(t)&&(w=E=Math.min(w,E)),e=0;s=this.selection_.item(e);e++)(r=0!==a&&this.get("enableRotatedTransform")?this.rotatedGeoms_[e].clone():this.geoms_[e].clone()).applyTransform(function(t,e,s){if(s<2)return e;if(d){var a=[[6],[0,8],[2],[4]],o=[t[0],t[1]],n=[t[2],t[3]],h=[t[4],t[5]],l=[t[6],t[7]],c=[t[8],t[9]];if(_){var g=f%2==0?this._countVector(o,n):this._countVector(l,o),p=this._projectVectorOnVector(x,g),v=[...a[f],...a[f+1<a.length?f+1:0]];for(i=0;i<t.length;i+=s)e[i]=v.includes(i)?t[i]+p[0]:t[i],e[i+1]=v.includes(i)?t[i+1]+p[1]:t[i+1]}else{var y,R;switch(f){case 0:x=this._countVector(l,m),y=this._projectVectorOnVector(x,this._countVector(h,l)),R=this._projectVectorOnVector(x,this._countVector(o,l)),[e[0],e[1]]=this._movePoint(o,y),[e[4],e[5]]=this._movePoint(h,R),[e[6],e[7]]=this._movePoint(l,x),[e[8],e[9]]=this._movePoint(c,y);break;case 1:x=this._countVector(o,m),y=this._projectVectorOnVector(x,this._countVector(l,o)),R=this._projectVectorOnVector(x,this._countVector(n,o)),[e[0],e[1]]=this._movePoint(o,x),[e[2],e[3]]=this._movePoint(n,y),[e[6],e[7]]=this._movePoint(l,R),[e[8],e[9]]=this._movePoint(c,x);break;case 2:x=this._countVector(n,m),y=this._projectVectorOnVector(x,this._countVector(o,n)),R=this._projectVectorOnVector(x,this._countVector(h,n)),[e[0],e[1]]=this._movePoint(o,R),[e[2],e[3]]=this._movePoint(n,x),[e[4],e[5]]=this._movePoint(h,y),[e[8],e[9]]=this._movePoint(c,R);break;case 3:x=this._countVector(h,m),y=this._projectVectorOnVector(x,this._countVector(n,h)),R=this._projectVectorOnVector(x,this._countVector(l,h)),[e[2],e[3]]=this._movePoint(n,R),[e[4],e[5]]=this._movePoint(h,x),[e[6],e[7]]=this._movePoint(l,y)}}}else for(i=0;i<t.length;i+=s)1!=w&&(e[i]=u[0]+(t[i]-u[0])*w),1!=E&&(e[i+1]=u[1]+(t[i+1]-u[1])*E);return"Circle"==r.getType()&&r.setCenterAndRadius(r.getCenter(),r.getRadius()),e}.bind(this)),this.get("enableRotatedTransform")&&0!==a&&r.rotate(a,this.getMap().getView().getCenter()),s.setGeometry(r);this.drawSketch_(),this.dispatchEvent({type:"scaling",feature:this.selection_.item(0),features:this.selection_,scale:[w,E],pixel:t.pixel,coordinate:t.coordinate})}this.isUpdating_=!1}}handleMoveEvent_(t){if(this._handleEvent(t,this.features_)&&!this.mode_){var e=this.getFeatureAtPixel_(t.pixel),i=t.map.getTargetElement();if(e.feature){var s=e.handle?this.Cursors[(e.handle||"default")+(e.constraint||"")+(e.option||"")]:this.Cursors.select;void 0===this.previousCursor_&&(this.previousCursor_=i.style.cursor),i.style.cursor=s}else void 0!==this.previousCursor_&&(i.style.cursor=this.previousCursor_),this.previousCursor_=void 0}}handleUpEvent_(t){"rotate"===this.mode_&&(t.map.getTargetElement().style.cursor=this.Cursors.default,this.previousCursor_=void 0);return this.dispatchEvent({type:this.mode_+"end",feature:this.selection_.item(0),features:this.selection_,oldgeom:this.geoms_[0],oldgeoms:this.geoms_}),this.drawSketch_(),this.mode_=null,!1}setPointRadius(t){this._pointRadius="function"==typeof t?t:function(){return t}}getFeatures(){return this.selection_}_projectVectorOnVector(t,e){var i=(t[0]*e[0]+t[1]*e[1])/(e[0]*e[0]+e[1]*e[1]);return[e[0]*i,e[1]*i]}_countVector(t,e){return[e[0]-t[0],e[1]-t[1]]}_movePoint(t,e){return[t[0]+e[0],t[1]+e[1]]}});B.prototype.Cursors={default:"auto",select:"pointer",translate:"move",rotate:"move",rotate0:"move",scale:"nesw-resize",scale1:"nwse-resize",scale2:"nesw-resize",scale3:"nwse-resize",scalev:"ew-resize",scaleh1:"ns-resize",scalev2:"ew-resize",scaleh3:"ns-resize"};var K=B,U=r("23ytq"),Q=(O=r("l9IGS"),F=r("2zf1Y"),r("1B70O"));(0,r("jZUWm").default)(t('<div> <h2> Day 12: GeoImage transform and scale </h2> <p> Use <a href="http://viglino.github.io/ol-ext/doc/doc-pages/ol.interaction.Transform.html" target="_new"> ol-ext Transform interaction</a> to scale a GeoImage on the map. </p> </div>')),Q.permalink.setUrlReplace(!1);const W=new(0,a.default)({layer:"GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2"});Q.default.addLayer(W),Q.default.getView().setZoom(14),Q.default.getView().setCenter([274764,6243935]);const X=new n({name:"Georef",opacity:1,source:new k({url:"https://viglino.github.io/ol-ext/examples/data/IGNF_PVA_1-0__1976-03-24_pt.jpg",imageCenter:[274764.75,6243935.64],imageScale:[.589,.597],imageRotate:7.44*Math.PI/180,projection:"EPSG:3857",attributions:["<a href='http://www.geoportail.gouv.fr/actualite/181/telechargez-les-cartes-et-photographies-aeriennes-historiques'>Photo historique &copy; IGN</a>"]})});Q.default.addLayer(X);const Y=new(0,a.default)({layer:"TRANSPORTNETWORKS.ROADS",opacity:.3});Q.default.addLayer(Y),X.getSource().getPolygon=function(){var t=this.getCenter(),e=this.getScale(),i=this.getGeoImage().width*e[0],s=this.getGeoImage().height*e[1],r=[t[0]-i/2,t[1]-s/2],a=[t[0]+i/2,t[1]+s/2],o=(0,m.boundingExtent)([r,a]),n=(0,V.fromExtent)(o);return n.rotate(-this.getRotation(),t),n};const J=new(0,j.default)({source:new(0,A.default),style:new(0,O.default)({fill:new(0,F.default)({color:"rgba(0,0,0,0)"})})});Q.default.addLayer(J);const $=new(0,M.default)(X.getSource().getPolygon());J.getSource().addFeature($),X.getSource().getGeoImage().addEventListener("load",(()=>{const t=new(0,M.default)(X.getSource().getPolygon());$.setGeometry(t.getGeometry())}));const tt=new K({selection:!1,stretch:!1,keepRectangle:!0});let et,it,st,rt;Q.default.addInteraction(tt),tt.select($,!0),tt.on("rotatestart",(t=>{et=X.getSource().getRotation()})),tt.on("rotating",(t=>{X.getSource().setRotation(et-t.angle)})),tt.on("translatestart",(t=>{it=X.getSource().getCenter()})),tt.on("translating",(t=>{it[0]+=t.delta[0],it[1]+=t.delta[1],X.getSource().setCenter(it)})),tt.on("scalestart",(t=>{st=X.getSource().getScale()[0],rt=X.getSource().getScale()[1]})),tt.on("scaling",(t=>{const e=$.getGeometry().getCoordinates().pop(),i=(0,U.ol_coordinate_dist2d)(e[0],e[1]),s=(0,U.ol_coordinate_dist2d)(e[1],e[2]),r=[(e[0][0]+e[2][0])/2,(e[0][1]+e[2][1])/2],a=X.getSource().getGeoImage();X.getSource().setScale([s/a.width,i/a.height]),X.getSource().setCenter(r)})),window.geoimg=X,window.transform=tt;
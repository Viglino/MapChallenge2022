function t(t){return t&&t.__esModule?t.default:t}var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r={},i={},o=e.parcelRequirecc54;null==o&&((o=function(t){if(t in r)return r[t].exports;if(t in i){var e=i[t];delete i[t];var o={id:t,exports:{}};return r[t]=o,e.call(o.exports,o,o.exports),o.exports}var s=new Error("Cannot find module '"+t+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(t,e){i[t]=e},e.parcelRequirecc54=o);var s=o("2YyN3"),a=o("ddIVC"),n=o("50PZ9"),l=o("bCUH1"),h=o("14PDX"),d=o("jZquI"),u=o("gzr8q");class c extends a.default{constructor(t){super(t),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(t){const e=t.layerStatesArray[t.layerIndex],r=t.pixelRatio,i=t.viewState,o=i.resolution,s=this.getLayer().getSource(),a=t.viewHints;let h=t.extent;if(void 0!==e.extent&&(h=(0,d.getIntersection)(h,(0,u.fromUserExtent)(e.extent,i.projection))),!a[l.default.ANIMATING]&&!a[l.default.INTERACTING]&&!(0,d.isEmpty)(h))if(s){const t=i.projection,e=s.getImage(h,o,r,t);e&&(this.loadImage(e)?this.image_=e:e.getState()===n.default.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(t){const e=this.frameState;if(!e)return null;const r=this.getLayer(),i=(0,h.apply)(e.pixelToCoordinateTransform,t.slice()),o=r.getExtent();if(o&&!(0,d.containsCoordinate)(o,i))return null;const s=this.image_.getExtent(),a=this.image_.getImage(),n=(0,d.getWidth)(s),l=Math.floor(a.width*((i[0]-s[0])/n));if(l<0||l>=a.width)return null;const u=(0,d.getHeight)(s),c=Math.floor(a.height*((s[3]-i[1])/u));return c<0||c>=a.height?null:this.getImageData(a,l,c)}renderFrame(t,e){const r=this.image_,i=r.getExtent(),o=r.getResolution(),s=r.getPixelRatio(),a=t.layerStatesArray[t.layerIndex],n=t.pixelRatio,l=t.viewState,c=l.center,f=n*o/(l.resolution*s),g=t.extent,p=l.resolution,_=l.rotation,w=Math.round((0,d.getWidth)(g)/p*n),m=Math.round((0,d.getHeight)(g)/p*n);(0,h.compose)(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/n,1/n,_,-w/2,-m/2),(0,h.makeInverse)(this.inversePixelTransform,this.pixelTransform);const y=(0,h.toString)(this.pixelTransform);this.useContainer(e,y,this.getBackground(t));const v=this.context,x=v.canvas;x.width!=w||x.height!=m?(x.width=w,x.height=m):this.containerReused||v.clearRect(0,0,w,m);let A=!1,I=!0;if(a.extent){const e=(0,u.fromUserExtent)(a.extent,l.projection);I=(0,d.intersects)(e,t.extent),A=I&&!(0,d.containsExtent)(e,t.extent),A&&this.clipUnrotated(v,t,e)}const R=r.getImage(),S=(0,h.compose)(this.tempTransform,w/2,m/2,f,f,0,s*(i[0]-c[0])/o,s*(c[1]-i[3])/o);this.renderedResolution=o*n/s;const C=R.width*S[0],T=R.height*S[3];if(this.getLayer().getSource().getInterpolate()||(v.imageSmoothingEnabled=!1),this.preRender(v,t),I&&C>=.5&&T>=.5){const t=S[4],e=S[5],r=a.opacity;let i;1!==r&&(i=v.globalAlpha,v.globalAlpha=r),v.drawImage(R,0,0,+R.width,+R.height,t,e,C,T),1!==r&&(v.globalAlpha=i)}return this.postRender(v,t),A&&v.restore(),v.imageSmoothingEnabled=!0,y!==x.style.transform&&(x.style.transform=y),this.container}}var f=c,g=o("6M65l"),p=o("cw4dl"),_=o("3QQdo");n=o("50PZ9");class w extends _.default{constructor(t,e,r,i,o){super(t,e,r,void 0!==o?n.default.IDLE:n.default.LOADED),this.loader_=void 0!==o?o:null,this.canvas_=i,this.error_=null}getError(){return this.error_}handleLoad_(t){t?(this.error_=t,this.state=n.default.ERROR):this.state=n.default.LOADED,this.changed()}load(){this.state==n.default.IDLE&&(this.state=n.default.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}var m=w,y=(n=o("50PZ9"),o("4wfAy"));l=o("bCUH1"),h=o("14PDX"),d=o("jZquI");var v=class extends f{constructor(t){super(t),this.vectorRenderer_=new(0,g.default)(t),this.layerImageRatio_=t.getImageRatio(),this.coordinateToVectorPixelTransform_=(0,h.create)(),this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(t){if(!this.vectorRenderer_)return new Promise((t=>t([])));const e=(0,h.apply)(this.coordinateToVectorPixelTransform_,(0,h.apply)(this.renderedPixelToCoordinateTransform_,t.slice()));return this.vectorRenderer_.getFeatures(e)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(e){const r=e.pixelRatio,i=e.viewState,o=i.resolution,s=e.viewHints,a=this.vectorRenderer_;let u=e.extent;1!==this.layerImageRatio_&&(u=u.slice(0),(0,d.scaleFromCenter)(u,this.layerImageRatio_));const c=(0,d.getWidth)(u)/o,f=(0,d.getHeight)(u)/o;if(!s[l.default.ANIMATING]&&!s[l.default.INTERACTING]&&!(0,d.isEmpty)(u)){a.useContainer(null,null);const s=a.context,l=e.layerStatesArray[e.layerIndex];s.globalAlpha=l.opacity;const d=Object.assign({},l,{opacity:1}),g=Object.assign({},e,{declutterTree:new(t(y))(9),extent:u,size:[c,f],viewState:Object.assign({},e.viewState,{rotation:0}),layerStatesArray:[d],layerIndex:0});let _=!0;const w=new m(u,o,r,s.canvas,(function(t){a.prepareFrame(g)&&a.replayGroupChanged&&(a.clipping=!1,a.renderFrame(g,null)&&(a.renderDeclutter(g),_=!1),t())}));w.addEventListener(p.default.CHANGE,function(){if(w.getState()!==n.default.LOADED)return;this.image_=_?null:w;const t=w.getResolution(),e=w.getPixelRatio(),o=t*r/e;this.renderedResolution=o,this.coordinateToVectorPixelTransform_=(0,h.compose)(this.coordinateToVectorPixelTransform_,c/2,f/2,1/o,-1/o,0,-i.center[0],-i.center[1])}.bind(this)),w.load()}return this.image_&&(this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice()),!!this.image_}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(t,e,r,i,o){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(t,e,r,i,o):super.forEachFeatureAtCoordinate(t,e,r,i,o)}};class x extends s.default{constructor(t){t=t||{};const e=Object.assign({},t);delete e.imageRatio,super(e),this.imageRatio_=void 0!==t.imageRatio?t.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new v(this)}}var A=x,I=o("20LS2"),R=o("6gELa"),S=o("kPMpK"),C=o("l9IGS"),T=o("lqNjm"),E=(T=o("lqNjm"),o("23ytq"));E=o("23ytq");(D=o("hvEnP")).default.prototype.splitAt=function(t,e){var r;if(!t)return[this];if(e||(e=1e-10),t.length&&t[0].length){var i=[this];for(r=0;r<t.length;r++){for(var o=[],s=0;s<i.length;s++){var a=i[s].splitAt(t[r],e);o=o.concat(a)}i=o}return i}if((0,E.ol_coordinate_equal)(t,this.getFirstCoordinate())||(0,E.ol_coordinate_equal)(t,this.getLastCoordinate()))return[this];var n=this.getCoordinates(),l=[n[0]],h=[];for(r=0;r<n.length-1;r++)if(!(0,E.ol_coordinate_equal)(n[r],n[r+1])){if((0,E.ol_coordinate_equal)(t,n[r+1]))l.push(n[r+1]),h.push(new(0,D.default)(l)),l=[];else if(!(0,E.ol_coordinate_equal)(t,n[r])){var d,u,c=!1;n[r][0]==n[r+1][0]?(d=(n[r][1]-t[1])/(n[r][1]-n[r+1][1]),c=n[r][0]==t[0]&&0<d&&d<=1):n[r][1]==n[r+1][1]?(d=(n[r][0]-t[0])/(n[r][0]-n[r+1][0]),c=n[r][1]==t[1]&&0<d&&d<=1):(d=(n[r][0]-t[0])/(n[r][0]-n[r+1][0]),u=(n[r][1]-t[1])/(n[r][1]-n[r+1][1]),c=Math.abs(d-u)<=e&&0<d&&d<=1),c&&(l.push(t),h.push(new(0,D.default)(l)),l=[t])}l.push(n[r+1])}return l.length>1&&h.push(new(0,D.default)(l)),h.length?h:[this]};var b=class extends C.default{constructor(t){super({stroke:(t=t||{}).stroke,text:t.text,zIndex:t.zIndex,geometry:t.geometry}),this.setRenderer(this._render.bind(this)),this._visible=!1!==t.visible,"function"==typeof t.width?this._widthFn=t.width:this.setWidth(t.width),this.setWidth2(t.width2),"function"==typeof t.color?this._colorFn=t.color:this.setColor(t.color),this.setColor2(t.color2),this.setLineCap(t.lineCap),this.setArrow(t.arrow),this.setArrowSize(t.arrowSize),this.setArrowColor(t.arrowColor),this._offset=[0,0],this.setOffset(t.offset0,0),this.setOffset(t.offset1,1),this._noOverlap=t.noOverlap}setWidth(t){this._width=t||0}setWidth2(t){this._width2=t}getOffset(t){return this._offset[t]}setOffset(t,e){switch(t=Math.max(0,parseFloat(t)),e){case 0:this._offset[0]=t;break;case 1:this._offset[1]=t}}setLineCap(t){this._lineCap="round"===t?"round":"butt"}getWidth(t,e){if(this._widthFn)return this._widthFn(t,e);var r="number"==typeof this._width2?this._width2:this._width;return this._width+(r-this._width)*e}setColor(t){try{this._color=(0,T.asArray)(t)}catch(t){this._color=[0,0,0,1]}}setColor2(t){try{this._color2=(0,T.asArray)(t)}catch(t){this._color2=null}}setArrowColor(t){try{this._acolor=(0,T.asString)(t)}catch(t){this._acolor=null}}getColor(t,e){if(this._colorFn)return(0,T.asString)(this._colorFn(t,e));var r=this._color,i=this._color2||this._color;return"rgba("+ +Math.round(r[0]+(i[0]-r[0])*e)+","+Math.round(r[1]+(i[1]-r[1])*e)+","+Math.round(r[2]+(i[2]-r[2])*e)+","+(r[3]+(i[3]-r[3])*e)+")"}getArrow(){return this._arrow}setArrow(t){this._arrow=parseInt(t),(this._arrow<-1||this._arrow>2)&&(this._arrow=0)}getArrowSize(){return this._arrowSize||[16,16]}setArrowSize(t){Array.isArray(t)?this._arrowSize=t:"number"==typeof t&&(this._arrowSize=[t,t])}drawArrow(t,e,r,i,o){var s=this.getArrowSize()[0]*o,a=(0,E.ol_coordinate_dist2d)(e,r),n=(e[0]-r[0])/a,l=(e[1]-r[1])/a;i=Math.max(this.getArrowSize()[1]/2,i/2)*o,t.beginPath(),t.moveTo(e[0],e[1]),t.lineTo(e[0]-s*n+i*l,e[1]-s*l-i*n),t.lineTo(e[0]-s*n-i*l,e[1]-s*l+i*n),t.lineTo(e[0],e[1]),t.fill()}_render(t,e){if("LineString"===e.geometry.getType()){var r,i,o,s=e.context;if(!this._visible){var a=e.pixelRatio/e.resolution,n=Math.cos(e.rotation),l=Math.sin(e.rotation);i=e.geometry.getCoordinates();var h=t[0][0]-i[0][0]*a*n-i[0][1]*a*l,d=t[0][1]-i[0][0]*a*l+i[0][1]*a*n;for(t=[],r=0;o=i[r];r++)t[r]=[h+o[0]*a*n+o[1]*a*l,d+o[0]*a*l-o[1]*a*n,o[2]]}var u=this.getArrowSize()[0]*e.pixelRatio;s.save(),this.getOffset(0)&&this._splitAsize(t,this.getOffset(0)*e.pixelRatio),this.getOffset(1)&&this._splitAsize(t,this.getOffset(1)*e.pixelRatio,!0),t.length>1&&(-1===this.getArrow()||2===this.getArrow())&&(o=this._splitAsize(t,u),this._acolor?s.fillStyle=this._acolor:s.fillStyle=this.getColor(e.feature,0),this.drawArrow(s,o[0],o[1],this.getWidth(e.feature,0),e.pixelRatio)),t.length>1&&this.getArrow()>0&&(o=this._splitAsize(t,u,!0),this._acolor?s.fillStyle=this._acolor:s.fillStyle=this.getColor(e.feature,1),this.drawArrow(s,o[0],o[1],this.getWidth(e.feature,1),e.pixelRatio));var c=this._splitInto(t,255,2),f=0,g=c.length;if(s.lineJoin="round",s.lineCap=this._lineCap||"butt",c.length>1)for(f=0;f<c.length;f++){var p=f/g;for(i=c[f],s.lineWidth=this.getWidth(e.feature,p)*e.pixelRatio,s.strokeStyle=this.getColor(e.feature,p),s.beginPath(),s.moveTo(i[0][0],i[0][1]),r=1;o=i[r];r++)s.lineTo(o[0],o[1]);s.stroke()}s.restore()}}_splitAsize(t,e,r){var i,o,s,a,n=0;for(i=s=r?t.pop():t.shift();t.length;){if(o=r?t.pop():t.shift(),n+(a=(0,E.ol_coordinate_dist2d)(i,o))>e){i=[i[0]+(o[0]-i[0])*(e-n)/a,i[1]+(o[1]-i[1])*(e-n)/a],a=(0,E.ol_coordinate_dist2d)(i,s),r?(t.push(o),t.push(i),t.push([i[0]+(s[0]-i[0])/a,i[1]+(s[1]-i[1])/a])):(t.unshift(o),t.unshift(i),t.unshift([i[0]+(s[0]-i[0])/a,i[1]+(s[1]-i[1])/a]));break}n+=a,i=o}return[s,i]}_splitInto(t,e,r){var i,o,s,a=this._noOverlap?1:.9,n=[],l=0;for(i=1;o=t[i];i++)l+=(0,E.ol_coordinate_dist2d)(t[i-1],o);var h=Math.max(r||2,l/(e||255)),d=t[0];l=0;var u=[d];for(i=1,o=t[1];i<t.length;){var c=o[0]-d[0],f=o[1]-d[1];if(l+(s=Math.sqrt(c*c+f*f))>h){var g=(h-l)/s;u.push([d[0]+c*g,d[1]+f*g]),n.push(u),u=[d=[d[0]+c*g*a,d[1]+f*g*a]],l=0}else l+=s,d=o,u.push(d),o=t[++i]}return n.push(u),n}},F=o("1B70O"),L=o("jZUWm");var P=o("ejLRd"),M=o("fkmMz"),O=o("6yJ0x"),z=o("iGyOD"),D=o("hvEnP");(0,L.default)(t('<div> <h2> Day 2: lines Flow lines style </h2> <p> Use <a href="http://viglino.github.io/ol-ext/doc/doc-pages/ol.style.FlowLine.html" target="_new"> ol-ext FlowLine Style </a> to display professionnal mobility (<a href="https://www.insee.fr/fr/statistiques/4509353" target="_new"> INSEE data &copy; 2017 </a>) </p> </div>'));const N=new(0,R.default)({layer:"GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2"});F.default.addLayer(N),F.default.getView().setMinZoom(6),F.default.getView().setCenter([251333,5895217]);const q=new A({source:new(0,I.default)({url:"https://viglino.github.io/ol-ext/examples/data/departements.geojson",format:new(0,S.default),attributions:["&copy; <a href='https://www.insee.fr'>INSEE</a>","&copy; <a href='https://www.data.gouv.fr/fr/datasets/geofla-r/'>IGN</a>"]})});F.default.addLayer(q);const G={},j=q.getSource().on("change",(function(t){if((0,P.unByKey)(j),"ready"===q.getSource().getState()){let t;q.getSource().getFeatures().forEach((function(e){let r,i=e.getGeometry();if("41"===e.get("id")&&(t=e),i.getInteriorPoint)r=i.getInteriorPoint().getFirstCoordinate();else{var o=0;i.getPolygons().forEach((function(t){var e=t.getArea();o<e&&(o=e,r=t.getInteriorPoint().getFirstCoordinate())}))}G[e.get("id")]={xy:r,data:[]}})),M.default.get({url:"https://viglino.github.io/ol-ext/examples/data/mobilite-2017.csv",dataType:"CSV",success:function(t){(t=t.split("\n")).shift(),t.forEach((function(t){t=t.split(","),G[t[0]]&&G[t[1]]&&G[t[0]].data.push({dep:t[1],xy:G[t[1]].xy,flow:parseInt(t[2])})}))}}),setTimeout((function(){}),0)}}));const W=new A({source:new(0,I.default),style:function(t,e){return new b({color:"red",color2:"yellow",width:2,width2:t.get("flow"),offset0:10,arrow:1,zIndex:-t.getGeometry().getLastCoordinate()[1]})}});F.default.addLayer(W);var k=new(0,O.default)({cursor:"pointer",layers:[q]});F.default.addInteraction(k),k.on("enter",(function(t){const e=t.feature;if(W.getSource().clear(),e){const t=e.get("id"),r=G[t];r.data.forEach((function(e){if(e.flow>300&&e.dep!==t){const t=new(0,z.default)(new(0,D.default)([r.xy,e.xy]));t.set("flow",Math.max(2,Math.min(30,e.flow/300))),t.set("flux",e.flow.toLocaleString()),W.getSource().addFeature(t)}}))}})),k.on("leave",(function(t){W.getSource().clear()}));